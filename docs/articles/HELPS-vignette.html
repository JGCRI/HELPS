<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HELPS-vignette â€¢ HELPS</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="HELPS-vignette">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">HELPS</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/HELPS-vignette.html">HELPS-vignette</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>HELPS-vignette</h1>
            
      

      <div class="hidden name"><code>HELPS-vignette.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">HELPS</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: sp</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: package 'dplyr' was built under R version 4.4.1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:raster':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, select, union</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/trevorld/ggpattern" class="external-link">ggpattern</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="gather-input-data">Gather input data:<a class="anchor" aria-label="anchor" href="#gather-input-data"></a>
</h2>
<div class="section level3">
<h3 id="download-example-data">Download example data<a class="anchor" aria-label="anchor" href="#download-example-data"></a>
</h3>
<p>Users can download a set of example data into folder
<code>HELPS_Example_Data</code> by running
<code><a href="../reference/get_example_data.html">get_example_data()</a></code>. The example data includes grid-level
daily and monthly near-surface air temperature (tas), daily and monthly
near-surface relative humidity (hurs), daily surface air pressure (ps),
and monthly grid-level surface downwelling shortwave radiation (rsds).
<em>User Notice</em> in the <em>README</em> provides more details of
input data <code>HELPS</code> is compatible with.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_example_data.html">get_example_data</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="prepare-your-own-input-data">Prepare your own input data<a class="anchor" aria-label="anchor" href="#prepare-your-own-input-data"></a>
</h3>
<p>The <code>HELPS</code> package operates on 0.5 degree resolution,
bias-corrected outputs from Earth System Models and General Circulation
Models participating in the CMIP process. Several options to access such
data exist: - The <a href="https://data.isimip.org/search/tree/ISIMIP2b/InputData/climate/atmosphere/" class="external-link">ISIMIP2b</a>
repository contains outputs from CMIP5-era models (GFDL-ESM2M,
HadGEM2-ES, IPSL-CM5A-LR, and MIROC5) for specific scenarios - The <a href="https://data.isimip.org/search/tree/ISIMIP3b/InputData/climate/atmosphere/" class="external-link">ISIMIP3b</a>
repository contains outputs from CMIP6-era models (GFDL-ESM4,
IPSL-CM6A-LR, MPI-ESM1-2-HR, MRI-ESM2-0, and UKSEM1-0-LL) for specific
scenarios - If a user wishes to explore other CMIP models or
bias-correct model data against different observational data than that
used by ISIMIP, the <a href="https://github.com/JGCRI/basd" class="external-link">BASD</a>
python package is available for ease of use. BASD implements an
extension of the bias adjustment and statistical downscaling method used
in ISIMIP3b (<a href="https://zenodo.org/records/4686991%20and%20https://gmd.copernicus.org/articles/12/3055/2019/" class="external-link">ISIMIP3BASD</a>,
Lange 2021). The ISIMIP3BASD code base can also be used directly. For
additional information, please see <a href="https://www.isimip.org/documents/413/ISIMIP3b_bias_adjustment_fact_sheet_Gnsz7CO.pdf" class="external-link">here</a>.
- If a user wishes to explore novel scenarios not covered by CMIP models
or the ISIMIP collection, we suggest a combination of <a href="https://github.com/JGCRI/stitches" class="external-link">STITCHES</a> emulation and BASD
bias correction and downscaling.</p>
<p>HELPS has been tested with both ISIMIP data and outputs from
BASD.</p>
<p>Besides the climate projections, <code>HELPS</code> also takes GGCMI
Phase 3 crop calendar (JÃ¤germeyr et al.Â 2021) (<a href="https://zenodo.org/records/5062513" class="external-link uri">https://zenodo.org/records/5062513</a>) and SPAM harvested
area (IFPRI, 2024) (<a href="https://doi.org/10.7910/DVN/SWPENT" class="external-link uri">https://doi.org/10.7910/DVN/SWPENT</a>) data as input for
temporal and spatial aggregation in the package.</p>
<p><code>HELPS</code> provides measurement of crop specific labor heat
stress exposure and heat-induced physical work capacity loss for 93
sectors, consisting of 46 SPAM crops by 2 irrigation practices (rain-fed
and irrigated) and 1 noncrop sector. Below is the fUll list of sectors
supported in <code>HELPS</code>, and refer to Table 1 for crop mapping.
Note that for SPAM crops without corresponding ggcmi crop calendar, the
crop calendar is assumed to be the whole year.</p>
<pre><code><span><span class="va">SECTOR_ALL</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"WHEA_I"</span>, <span class="st">"RICE_I"</span>, <span class="st">"MAIZ_I"</span>, <span class="st">"SOYB_I"</span>, <span class="st">"BARL_I"</span>, <span class="st">"MILL_I"</span>, <span class="st">"PMIL_I"</span>, <span class="st">"SORG_I"</span>, <span class="st">"OCER_I"</span>,</span>
<span>                <span class="st">"POTA_I"</span>, <span class="st">"SWPO_I"</span>, <span class="st">"YAMS_I"</span>, <span class="st">"CASS_I"</span>, <span class="st">"BEAN_I"</span>, <span class="st">"CHIC_I"</span>, <span class="st">"COWP_I"</span>, <span class="st">"PIGE_I"</span>, <span class="st">"LENT_I"</span>,</span>
<span>                <span class="st">"GROU_I"</span>, <span class="st">"SUNF_I"</span>, <span class="st">"RAPE_I"</span>, <span class="st">"SESA_I"</span>, <span class="st">"SUGC_I"</span>, <span class="st">"SUGB_I"</span>, <span class="st">"COTT_I"</span>, <span class="st">"OFIB_I"</span>, <span class="st">"BANA_I"</span>,</span>
<span>                <span class="st">"PLNT_I"</span>, <span class="st">"CITR_I"</span>, <span class="st">"TROF_I"</span>, <span class="st">"TEMF_I"</span>, <span class="st">"TOMA_I"</span>, <span class="st">"ONIO_I"</span>, <span class="st">"VEGE_I"</span>, <span class="st">"ORTS_I"</span>, <span class="st">"OPUL_I"</span>,</span>
<span>                <span class="st">"CNUT_I"</span>, <span class="st">"OILP_I"</span>, <span class="st">"OOIL_I"</span>, <span class="st">"COFF_I"</span>, <span class="st">"RCOF_I"</span>, <span class="st">"COCO_I"</span>, <span class="st">"RUBB_I"</span>, <span class="st">"TEAS_I"</span>, <span class="st">"TOBA_I"</span>,</span>
<span>                <span class="st">"REST_I"</span>,</span>
<span>                <span class="st">"WHEA_R"</span>, <span class="st">"RICE_R"</span>, <span class="st">"MAIZ_R"</span>, <span class="st">"SOYB_R"</span>, <span class="st">"BARL_R"</span>, <span class="st">"MILL_R"</span>, <span class="st">"PMIL_R"</span>, <span class="st">"SORG_R"</span>, <span class="st">"OCER_R"</span>,</span>
<span>                <span class="st">"POTA_R"</span>, <span class="st">"SWPO_R"</span>, <span class="st">"YAMS_R"</span>, <span class="st">"CASS_R"</span>, <span class="st">"BEAN_R"</span>, <span class="st">"CHIC_R"</span>, <span class="st">"COWP_R"</span>, <span class="st">"PIGE_R"</span>, <span class="st">"LENT_R"</span>,</span>
<span>                <span class="st">"GROU_R"</span>, <span class="st">"MAIZ_R"</span>, <span class="st">"RAPE_R"</span>, <span class="st">"SESA_R"</span>, <span class="st">"SUGC_R"</span>, <span class="st">"SUGB_R"</span>, <span class="st">"COTT_R"</span>, <span class="st">"OFIB_R"</span>, <span class="st">"BANA_R"</span>,</span>
<span>                <span class="st">"PLNT_R"</span>, <span class="st">"CITR_R"</span>, <span class="st">"TROF_R"</span>, <span class="st">"TEMF_R"</span>, <span class="st">"TOMA_R"</span>, <span class="st">"ONIO_R"</span>, <span class="st">"VEGE_R"</span>, <span class="st">"ORTS_R"</span>, <span class="st">"OPUL_R"</span>,</span>
<span>                <span class="st">"CNUT_R"</span>, <span class="st">"OILP_R"</span>, <span class="st">"OOIL_R"</span>, <span class="st">"COFF_R"</span>, <span class="st">"RCOF_R"</span>, <span class="st">"COCO_R"</span>, <span class="st">"RUBB_R"</span>, <span class="st">"TEAS_R"</span>, <span class="st">"TOBA_R"</span>,</span>
<span>                <span class="st">"REST_R"</span>,</span>
<span>                <span class="st">"NONCROP"</span><span class="op">)</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="table-1--mapping-ggcmi-crop-calendar-to-spam-crops-">Table 1. Mapping ggcmi crop calendar to SPAM crops.<a class="anchor" aria-label="anchor" href="#table-1--mapping-ggcmi-crop-calendar-to-spam-crops-"></a>
</h3>
<table class="table">
<thead><tr class="header">
<th>SPAM</th>
<th>SPAM Crop Name</th>
<th>ggcmi</th>
<th>ggcmi Crop Name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>WHEA</td>
<td>Wheat</td>
<td>wh</td>
<td>wheat</td>
</tr>
<tr class="even">
<td>RICE</td>
<td>Rice</td>
<td>ri</td>
<td>rice</td>
</tr>
<tr class="odd">
<td>MAIZ</td>
<td>Maize</td>
<td>mai</td>
<td>maize</td>
</tr>
<tr class="even">
<td>SOYB</td>
<td>Soybean</td>
<td>soy</td>
<td>soybean</td>
</tr>
<tr class="odd">
<td>BARL</td>
<td>Barley</td>
<td>bar</td>
<td>barley</td>
</tr>
<tr class="even">
<td>MILL</td>
<td>Small Millet</td>
<td>mil</td>
<td>millet</td>
</tr>
<tr class="odd">
<td>PMIL</td>
<td>Pearl Millet</td>
<td>mil</td>
<td>millet</td>
</tr>
<tr class="even">
<td>SORG</td>
<td>Sorghum</td>
<td>sor</td>
<td>sorghum</td>
</tr>
<tr class="odd">
<td>OCER</td>
<td>Other Cereals</td>
<td>rye</td>
<td>rye</td>
</tr>
<tr class="even">
<td>POTA</td>
<td>Potato</td>
<td>pot</td>
<td>potato</td>
</tr>
<tr class="odd">
<td>SWPO</td>
<td>Sweet Potato</td>
<td>cas</td>
<td>cassava</td>
</tr>
<tr class="even">
<td>YAMS</td>
<td>Yams</td>
<td>cas</td>
<td>cassava</td>
</tr>
<tr class="odd">
<td>CASS</td>
<td>Cassava</td>
<td>cas</td>
<td>cassava</td>
</tr>
<tr class="even">
<td>BEAN</td>
<td>Bean</td>
<td>bea</td>
<td>beans</td>
</tr>
<tr class="odd">
<td>CHIC</td>
<td>Chickpea</td>
<td>pea</td>
<td>field peas</td>
</tr>
<tr class="even">
<td>COWP</td>
<td>Cowpea</td>
<td>pea</td>
<td>beans</td>
</tr>
<tr class="odd">
<td>PIGE</td>
<td>Pigeon Pea</td>
<td>pea</td>
<td>beans</td>
</tr>
<tr class="even">
<td>LENT</td>
<td>Lentil</td>
<td>pea</td>
<td>field peas</td>
</tr>
<tr class="odd">
<td>GROU</td>
<td>Groundnut</td>
<td>nut</td>
<td>groundnut</td>
</tr>
<tr class="even">
<td>SUNF</td>
<td>Sunflower</td>
<td>sun</td>
<td>sunflower</td>
</tr>
<tr class="odd">
<td>RAPE</td>
<td>Rapeseed</td>
<td>rap</td>
<td>rapeseed</td>
</tr>
<tr class="even">
<td>SESA</td>
<td>Sesame Seed</td>
<td>sun</td>
<td>sunflower</td>
</tr>
<tr class="odd">
<td>SUGC</td>
<td>Sugarcane</td>
<td>sgc</td>
<td>sugar cane</td>
</tr>
<tr class="even">
<td>SUGB</td>
<td>Sugarbeet</td>
<td>sgb</td>
<td>sugar beet</td>
</tr>
<tr class="odd">
<td>COTT</td>
<td>Cotton</td>
<td>cot</td>
<td>cotton</td>
</tr>
<tr class="even">
<td>OFIB</td>
<td>Other Fiber Crops</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>BANA</td>
<td>Banana</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>PLNT</td>
<td>Plantain</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>CITR</td>
<td>Citrus</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>TROF</td>
<td>Other Tropical Fruit</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>TEMF</td>
<td>Temperate Fruit</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>TOMA</td>
<td>Tomato</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>ONIO</td>
<td>Onion</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>VEGE</td>
<td>Other Vegetables</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>ORTS</td>
<td>Other Roots</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>OPUL</td>
<td>Other Pulses</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>CNUT</td>
<td>Coconut</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>OILP</td>
<td>Oilpalm</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>OOIL</td>
<td>Other Oil Crops</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>COFF</td>
<td>Arabic Coffee</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>RCOF</td>
<td>Robust Coffee</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>COCO</td>
<td>Cocoa</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>RUBB</td>
<td>Rubber</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>TEAS</td>
<td>Tea</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>TOBA</td>
<td>Tobacco</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>REST</td>
<td>Rest Of Crops</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2">
<h2 id="daily-gridded-inputs">1. Daily gridded inputs:<a class="anchor" aria-label="anchor" href="#daily-gridded-inputs"></a>
</h2>
<div class="section level3">
<h3 id="step1-1-calculate-daily-gridded-heat-stress">Step1.1: calculate daily gridded heat stress<a class="anchor" aria-label="anchor" href="#step1-1-calculate-daily-gridded-heat-stress"></a>
</h3>
<p>This step employs <code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code> function, which
takes multiple arguments. <code>SECTOR</code> denotes which sector the
labor is involved in. The current version of <strong>HELPS</strong>
supports 93 sectors, consists of 92 crop sectors (46 SPAM crops by 2
irrigation practices) and 1 non-crop sector. <code>HS</code> denotes the
heat stress function that takes atmospheric variables as input and
outputs heat stress level. The current version of <strong>HELPS</strong>
covers 3 <code>HS()</code>, <code><a href="../reference/WBGT_ESI.html">WBGT_ESI()</a></code>,
<code><a href="../reference/WBGT_shade.html">WBGT_shade()</a></code>, and <code><a href="../reference/WBGT_sun.html">WBGT_sun()</a></code>.
<code>WBGT_ESI</code>, Environmental Stress Index, takes hurs, tas, and
rsds as inputs to approximate WBGT. <code>WBGT_shade</code>, from Dunne
et al.Â (2013), takes hurs, tas, and ps as inputs to approximate WBGT.
This method assumes full shade and night adaptation and optimization of
structures, clothing, activity scheduling. <code>WBGT_sun</code>, is
<code>WBGT_shade + 3</code>, that approximate the WBGT without
shade.</p>
<p><code>YEAR_INPUT</code> denotes a year of interest. <code>...</code>
denotes the file name(s) of atmospheric variable projections. Note that
the number of files need to be equal to the number of argument of
<code>HS()</code>. Example below takes monthly <em>hurs</em> (relative
humidity), <em>tas</em> (near-surface air temperature), and <em>ps</em>
(surface air pressure) and <em>WBGT_ESI</em> to calculate heat stress
levels.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wbgt.sun.day</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_heat_stress.html">cal_heat_stress</a></span><span class="op">(</span>TempRes <span class="op">=</span> <span class="st">"day"</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span>, HS <span class="op">=</span> <span class="va">WBGT_sun</span>, YEAR_INPUT <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/hurs_example_day.nc"</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/tas_example_day.nc"</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/ps_example_day.nc"</span><span class="op">)</span></span>
<span><span class="co">#&gt; |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          |---------|---------|---------|---------|=========================================                                          </span></span>
<span><span class="va">wbgt.sun.day</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 366  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      :  X2024.01.01,  X2024.01.02,  X2024.01.03,  X2024.01.04,  X2024.01.05,  X2024.01.06,  X2024.01.07,  X2024.01.08,  X2024.01.09,  X2024.01.10,  X2024.01.11,  X2024.01.12,  X2024.01.13,  X2024.01.14,  X2024.01.15, ... </span></span>
<span><span class="co">#&gt; min values : -26.40895633, -29.58631649, -29.48563671, -32.64279411, -32.68470744, -31.52423488, -30.81504258, -31.72978783, -32.97928824, -31.53499160, -30.23718614, -26.68727971, -27.45448612, -30.39889939, -29.37254204, ... </span></span>
<span><span class="co">#&gt; max values :     33.69000,     33.01880,     32.68530,     33.07450,     32.27624,     32.50649,     32.55792,     32.97666,     33.03015,     33.14957,     33.11487,     32.81420,     32.97180,     32.96513,     32.74074, ...</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wbgt.day.plot</span> <span class="op">&lt;-</span> <span class="va">wbgt.sun.day</span><span class="op">[[</span><span class="fl">183</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">format_longitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lon</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lon</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°E"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°W"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">format_latitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°N"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°S"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">wbgt.day.plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"blue"</span>, mid <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span>, midpoint <span class="op">=</span> <span class="fl">25</span>,</span>
<span>                       na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"WBGT"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Heat stress for labor in rain-fed maize sector: 2024-07-01"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>, <span class="co"># Longitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_longitude</span>         <span class="co"># Apply custom labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,    <span class="co"># Latitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_latitude</span>           <span class="co"># Apply custom latitude labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step1.1.1-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="step1-2-calculate-daily-gridded-physical-work-capacity">Step1.2: calculate daily gridded physical work capacity<a class="anchor" aria-label="anchor" href="#step1-2-calculate-daily-gridded-physical-work-capacity"></a>
</h3>
<p>This step employs <code><a href="../reference/cal_pwc.html">cal_pwc()</a></code> function, which takes
multiple arguments. <code>WBGT</code> denotes the output of
<code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code> from last step. <code>LHR</code> denotes
the labor-heat response function that takes heat stress level and
workload intensity as input and outputs physical work capacity (PWC).
<code>workload</code> varies across alternative industries, we suggest
â€˜highâ€™ for construction or agricultural work, â€˜moderateâ€™ for average
manufacturing industry work, and â€˜lowâ€™ for office desk work and service
industries. There are 4 built-in <code>LHR</code> functions in
<code>HELPS</code>. <code>LHR_Hothaps</code> is based on the <em>high
occupational temperature health and productivity suppression
(Hothaps)</em> programme, derived by Kjellstrom et al.Â (2018).
<code>LHR_NOISH</code> calculate the labor productivity based on the
National Institute for Occupational Safety and Health (NIOSH) standard.
<code>LHR_ISO</code> calculate the labor productivity based on the
ISO7243 standard. <code>LHR_Foster</code> calculate the labor
productivity based on Foster et al (2021) Table 3. Note that
<code>LHR_Foster</code> does not need workload as input, while the rest
three LHRs need.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwc.hothaps.day</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_pwc.html">cal_pwc</a></span><span class="op">(</span>WBGT <span class="op">=</span> <span class="va">wbgt.sun.day</span>,  LHR <span class="op">=</span> <span class="va">LHR_Hothaps</span>, workload <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">pwc.hothaps.day</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 366  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.01.02, X2024.01.03, X2024.01.04, X2024.01.05, X2024.01.06, X2024.01.07, X2024.01.08, X2024.01.09, X2024.01.10, X2024.01.11, X2024.01.12, X2024.01.13, X2024.01.14, X2024.01.15, ... </span></span>
<span><span class="co">#&gt; min values :   0.2756310,   0.3278060,   0.3577239,   0.3230669,   0.3979197,   0.3748341,   0.3698383,   0.3314406,   0.3268341,   0.3167981,   0.3196790,   0.3458487,   0.3318618,   0.3324419,   0.3525687, ... </span></span>
<span><span class="co">#&gt; max values :           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1, ...</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwc.day.plot</span> <span class="op">&lt;-</span> <span class="va">pwc.hothaps.day</span><span class="op">[[</span><span class="fl">183</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">format_longitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lon</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lon</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°E"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°W"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">format_latitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°N"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°S"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pwc.day.plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                      na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"PWC \nloss(%)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Heat-induced PWC loss for labor in rain-fed maize sector: 2024-07-01"</span><span class="op">)</span> <span class="op">+</span></span>
<span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>, <span class="co"># Longitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_longitude</span>         <span class="co"># Apply custom labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,    <span class="co"># Latitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_latitude</span>           <span class="co"># Apply custom latitude labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step1.2.1-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="step1-3-aggregate-daily-value-to-monthly-value">Step1.3: aggregate daily value to monthly value<a class="anchor" aria-label="anchor" href="#step1-3-aggregate-daily-value-to-monthly-value"></a>
</h3>
<p>This step employs <code><a href="../reference/daily_to_monthly.html">daily_to_monthly()</a></code> function, which
takes the daily output (a raster rack with 365/366 layers) from
<code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code> or <code><a href="../reference/cal_pwc.html">cal_pwc()</a></code> as input, and
outputs a raster rack of 12 layers with monthly mean.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wbgt.sun.mon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_to_monthly.html">daily_to_monthly</a></span><span class="op">(</span>input_rack <span class="op">=</span> <span class="va">wbgt.sun.day</span><span class="op">)</span></span>
<span><span class="co"># rm(wbgt.sun.day)</span></span>
<span><span class="va">pwc.hothaps.mon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/daily_to_monthly.html">daily_to_monthly</a></span><span class="op">(</span>input_rack <span class="op">=</span> <span class="va">pwc.hothaps.day</span><span class="op">)</span></span>
<span><span class="co"># rm(pwc.hothaps.day)</span></span>
<span><span class="va">wbgt.sun.mon</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      :     index_01,     index_02,     index_03,     index_04,     index_05,     index_06,     index_07,     index_08,     index_09,     index_10,     index_11,     index_12 </span></span>
<span><span class="co">#&gt; min values : -25.68471515, -23.78440403, -12.62054358,   1.75700482,   6.92253558,   6.54223091,   5.56819113,   6.83117556,   7.97842251,  -0.04127564, -12.79007390, -22.36117065 </span></span>
<span><span class="co">#&gt; max values :     32.50636,     32.81493,     33.21978,     34.08683,     36.81503,     36.44158,     35.34854,     33.97071,     33.59198,     33.30904,     32.27484,     32.16073</span></span>
<span><span class="va">pwc.hothaps.mon</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      :  index_01,  index_02,  index_03,  index_04,  index_05,  index_06,  index_07,  index_08,  index_09,  index_10,  index_11,  index_12 </span></span>
<span><span class="co">#&gt; min values : 0.3763610, 0.3469435, 0.3125562, 0.2535550, 0.1491326, 0.1614964, 0.1957440, 0.2707452, 0.2842605, 0.3163960, 0.4007928, 0.4139707 </span></span>
<span><span class="co">#&gt; max values :         1,         1,         1,         1,         1,         1,         1,         1,         1,         1,         1,         1</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwc.mon.plot</span> <span class="op">&lt;-</span> <span class="va">pwc.hothaps.mon</span><span class="op">[[</span><span class="fl">7</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span></span>
<span><span class="va">format_longitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lon</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lon</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°E"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°W"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">format_latitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°N"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°S"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pwc.mon.plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                      na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"PWC \nloss(%)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Monthly heat-induced PWC loss for labor in rain-fed maize sector: 2024-07"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>, <span class="co"># Longitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_longitude</span>         <span class="co"># Apply custom labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,    <span class="co"># Latitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_latitude</span>           <span class="co"># Apply custom latitude labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step1.3.1-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="step1-4-aggregate-monthly-value-to-annual-value">Step1.4: aggregate monthly value to annual value<a class="anchor" aria-label="anchor" href="#step1-4-aggregate-monthly-value-to-annual-value"></a>
</h3>
<p>This step employs <code><a href="../reference/monthly_to_annual.html">monthly_to_annual()</a></code> function, which
takes a raster rack with 12 layers of monthly mean as input, and outputs
a data frame with grid-level annual mean. In this step, make sure the
<code>SECTOR</code> input in <code><a href="../reference/monthly_to_annual.html">monthly_to_annual()</a></code> is
identical to the <code>SECTOR</code> input in
<code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wbgt.sun.ann</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monthly_to_annual.html">monthly_to_annual</a></span><span class="op">(</span>input_rack <span class="op">=</span> <span class="va">wbgt.sun.mon</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span><span class="op">)</span></span>
<span><span class="va">pwc.hothaps.ann</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monthly_to_annual.html">monthly_to_annual</a></span><span class="op">(</span>input_rack <span class="op">=</span> <span class="va">pwc.hothaps.mon</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">wbgt.sun.ann</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x                 y              value       </span></span>
<span><span class="co">#&gt;  Min.   :-179.75   Min.   :-89.75   Min.   : 8.87   </span></span>
<span><span class="co">#&gt;  1st Qu.: -89.88   1st Qu.:-44.88   1st Qu.:19.46   </span></span>
<span><span class="co">#&gt;  Median :   0.00   Median :  0.00   Median :25.74   </span></span>
<span><span class="co">#&gt;  Mean   :   0.00   Mean   :  0.00   Mean   :24.41   </span></span>
<span><span class="co">#&gt;  3rd Qu.:  89.88   3rd Qu.: 44.88   3rd Qu.:29.17   </span></span>
<span><span class="co">#&gt;  Max.   : 179.75   Max.   : 89.75   Max.   :34.00   </span></span>
<span><span class="co">#&gt;                                     NA's   :238410</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pwc.hothaps.ann</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x                 y              value       </span></span>
<span><span class="co">#&gt;  Min.   :-179.75   Min.   :-89.75   Min.   :0.29    </span></span>
<span><span class="co">#&gt;  1st Qu.: -89.88   1st Qu.:-44.88   1st Qu.:0.73    </span></span>
<span><span class="co">#&gt;  Median :   0.00   Median :  0.00   Median :0.90    </span></span>
<span><span class="co">#&gt;  Mean   :   0.00   Mean   :  0.00   Mean   :0.85    </span></span>
<span><span class="co">#&gt;  3rd Qu.:  89.88   3rd Qu.: 44.88   3rd Qu.:0.99    </span></span>
<span><span class="co">#&gt;  Max.   : 179.75   Max.   : 89.75   Max.   :1.00    </span></span>
<span><span class="co">#&gt;                                     NA's   :238410</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">format_longitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lon</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lon</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°E"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°W"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">format_latitude</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">lat</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°N"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"Â°S"</span><span class="op">)</span></span>
<span>    <span class="kw">else</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"Â°"</span><span class="op">)</span> <span class="co"># Handle 0Â° specifically</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">pwc.hothaps.ann</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span>, <span class="st">"value"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fl">100</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span>,</span>
<span>                      na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"PWC \nloss(%)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Annual heat-induced PWC loss for labor in rain-fed maize sector: 2024"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">180</span>, by <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>, <span class="co"># Longitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_longitude</span>         <span class="co"># Apply custom labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="fl">90</span>, by <span class="op">=</span> <span class="fl">30</span><span class="op">)</span>,    <span class="co"># Latitude breaks</span></span>
<span>    labels <span class="op">=</span> <span class="va">format_latitude</span>           <span class="co"># Apply custom latitude labels</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step1.4.1-1.png" width="960"></p>
</div>
</div>
<div class="section level2">
<h2 id="monthly-gridded-inputs">2. Monthly gridded inputs:<a class="anchor" aria-label="anchor" href="#monthly-gridded-inputs"></a>
</h2>
<div class="section level3">
<h3 id="step2-1-calculate-monthly-gridded-heat-stress">Step2.1: calculate monthly gridded heat stress<a class="anchor" aria-label="anchor" href="#step2-1-calculate-monthly-gridded-heat-stress"></a>
</h3>
<p>Similar to <em>Step1.1</em>, this steps
employs<code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code> function. Example below takes
monthly <em>hurs</em> (relative humidity), <em>tas</em> (near-surface
air temperature), and <em>rsds</em> (surface downwelling shortwave
radiation) and <em>WBGT_ESI</em> to calculate heat stress levels.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">esi.mon</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_heat_stress.html">cal_heat_stress</a></span><span class="op">(</span>TempRes <span class="op">=</span> <span class="st">"month"</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span>, HS <span class="op">=</span> <span class="va">WBGT_ESI</span>, YEAR_INPUT <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/hurs_example_month.nc"</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/tas_example_month.nc"</span>,</span>
<span>                    <span class="st">"../HELPS_Example_Data/rsds_example_month.nc"</span><span class="op">)</span></span>
<span><span class="va">esi.mon</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.02.01, X2024.03.01, X2024.04.01, X2024.05.01, X2024.06.01, X2024.07.01, X2024.08.01, X2024.09.01, X2024.10.01, X2024.11.01, X2024.12.01 </span></span>
<span><span class="co">#&gt; min values : -30.0640459, -19.3581926, -11.5180495,  -3.6726991,  -3.2108038,  -0.2240083,  -0.4961621,   0.2276950,   1.7499020,  -5.9289555, -15.8256390, -26.2432665 </span></span>
<span><span class="co">#&gt; max values :    30.42680,    30.49348,    30.82212,    31.40889,    32.81928,    32.28757,    32.19278,    34.97054,    31.99175,    30.88973,    30.47448,    30.35880</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step2-2-calculate-daily-gridded-physical-work-capacity">Step2.2: calculate daily gridded physical work capacity<a class="anchor" aria-label="anchor" href="#step2-2-calculate-daily-gridded-physical-work-capacity"></a>
</h3>
<p>Similar to <em>Step1.2</em>, this step employs <code><a href="../reference/cal_pwc.html">cal_pwc()</a></code>
function to translate heat stress to PWC. Here we demonstrate the
uncertainty in PWC introduced by alternative choices of
<code>LHR()</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pwc.mon.foster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_pwc.html">cal_pwc</a></span><span class="op">(</span>WBGT <span class="op">=</span> <span class="va">esi.mon</span>,  LHR <span class="op">=</span> <span class="va">LHR_Foster</span>, workload <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">-</span> <span class="va">start_t</span></span>
<span><span class="co">#&gt; Time difference of 24.06208 secs</span></span>
<span><span class="va">pwc.mon.foster</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.02.01, X2024.03.01, X2024.04.01, X2024.05.01, X2024.06.01, X2024.07.01, X2024.08.01, X2024.09.01, X2024.10.01, X2024.11.01, X2024.12.01 </span></span>
<span><span class="co">#&gt; min values :   0.6533050,   0.6501601,   0.6345732,   0.6064736,   0.5385404,   0.5641103,   0.5686807,   0.4384579,   0.5783792,   0.6313511,   0.6510568,   0.6565059 </span></span>
<span><span class="co">#&gt; max values :           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pwc.mon.hothaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_pwc.html">cal_pwc</a></span><span class="op">(</span>WBGT <span class="op">=</span> <span class="va">esi.mon</span>,  LHR <span class="op">=</span> <span class="va">LHR_Hothaps</span>, workload <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">-</span> <span class="va">start_t</span></span>
<span><span class="co">#&gt; Time difference of 2.135873 secs</span></span>
<span><span class="va">pwc.mon.hothaps</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.02.01, X2024.03.01, X2024.04.01, X2024.05.01, X2024.06.01, X2024.07.01, X2024.08.01, X2024.09.01, X2024.10.01, X2024.11.01, X2024.12.01 </span></span>
<span><span class="co">#&gt; min values :   0.6122205,   0.6041627,   0.5642868,   0.4939780,   0.3453890,   0.3967577,   0.4065681,   0.2037740,   0.4279751,   0.5560881,   0.6064606,   0.6204154 </span></span>
<span><span class="co">#&gt; max values :           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pwc.mon.niosh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_pwc.html">cal_pwc</a></span><span class="op">(</span>WBGT <span class="op">=</span> <span class="va">esi.mon</span>,  LHR <span class="op">=</span> <span class="va">LHR_NIOSH</span>, workload <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">-</span> <span class="va">start_t</span></span>
<span><span class="co">#&gt; Time difference of 36.07453 secs</span></span>
<span><span class="va">pwc.mon.niosh</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.02.01, X2024.03.01, X2024.04.01, X2024.05.01, X2024.06.01, X2024.07.01, X2024.08.01, X2024.09.01, X2024.10.01, X2024.11.01, X2024.12.01 </span></span>
<span><span class="co">#&gt; min values :  0.40541344,  0.39455381,  0.34102517,  0.24545289,  0.01573204,  0.10233571,  0.11777393,  0.00000000,  0.15051810,  0.33001362,  0.39764804,  0.41648961 </span></span>
<span><span class="co">#&gt; max values :           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">pwc.mon.iso</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cal_pwc.html">cal_pwc</a></span><span class="op">(</span>WBGT <span class="op">=</span> <span class="va">esi.mon</span>,  LHR <span class="op">=</span> <span class="va">LHR_ISO</span>, workload <span class="op">=</span> <span class="st">"high"</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.time</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">end_t</span> <span class="op">-</span> <span class="va">start_t</span></span>
<span><span class="co">#&gt; Time difference of 35.56711 secs</span></span>
<span><span class="va">pwc.mon.iso</span></span>
<span><span class="co">#&gt; class      : RasterStack </span></span>
<span><span class="co">#&gt; dimensions : 360, 720, 259200, 12  (nrow, ncol, ncell, nlayers)</span></span>
<span><span class="co">#&gt; resolution : 0.5, 0.5  (x, y)</span></span>
<span><span class="co">#&gt; extent     : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; crs        : +proj=longlat +datum=WGS84 +no_defs </span></span>
<span><span class="co">#&gt; names      : X2024.01.01, X2024.02.01, X2024.03.01, X2024.04.01, X2024.05.01, X2024.06.01, X2024.07.01, X2024.08.01, X2024.09.01, X2024.10.01, X2024.11.01, X2024.12.01 </span></span>
<span><span class="co">#&gt; min values :  0.31366412,  0.30282677,  0.24940795,  0.15403174,  0.00000000,  0.01120817,  0.02661472,  0.00000000,  0.05929171,  0.23841899,  0.30591465,  0.32471757 </span></span>
<span><span class="co">#&gt; max values :           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1,           1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="step2-3-aggregate-monthly-value-to-annual-value">Step2.3: aggregate monthly value to annual value<a class="anchor" aria-label="anchor" href="#step2-3-aggregate-monthly-value-to-annual-value"></a>
</h3>
<p>Same as <em>Step1.4</em>, make sure the <code>SECTOR</code> input in
<code><a href="../reference/monthly_to_annual.html">monthly_to_annual()</a></code> is identical to the <code>SECTOR</code>
input in <code><a href="../reference/cal_heat_stress.html">cal_heat_stress()</a></code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pwc.hothaps.ann2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/monthly_to_annual.html">monthly_to_annual</a></span><span class="op">(</span>input_rack <span class="op">=</span> <span class="va">pwc.mon.hothaps</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">pwc.hothaps.ann2</span><span class="op">)</span></span>
<span><span class="co">#&gt;        x                 y              value       </span></span>
<span><span class="co">#&gt;  Min.   :-179.75   Min.   :-89.75   Min.   :0.45    </span></span>
<span><span class="co">#&gt;  1st Qu.: -89.88   1st Qu.:-44.88   1st Qu.:0.95    </span></span>
<span><span class="co">#&gt;  Median :   0.00   Median :  0.00   Median :0.99    </span></span>
<span><span class="co">#&gt;  Mean   :   0.00   Mean   :  0.00   Mean   :0.97    </span></span>
<span><span class="co">#&gt;  3rd Qu.:  89.88   3rd Qu.: 44.88   3rd Qu.:1.00    </span></span>
<span><span class="co">#&gt;  Max.   : 179.75   Max.   : 89.75   Max.   :1.00    </span></span>
<span><span class="co">#&gt;                                     NA's   :238410</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="spatial-aggregation-grid-to-region">3. Spatial aggregation: grid to region<a class="anchor" aria-label="anchor" href="#spatial-aggregation-grid-to-region"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># aggregate grid level PWC to country level</span></span>
<span><span class="va">ctry_pwc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_to_region.html">grid_to_region</a></span><span class="op">(</span>grid_annual_value <span class="op">=</span> <span class="va">pwc.hothaps.ann</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span>, rast_boundary <span class="op">=</span> <span class="va">country_raster</span><span class="op">)</span></span>
<span><span class="co"># aggregate grid level PWC to GCAM water basin level</span></span>
<span><span class="va">glu_pwc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grid_to_region.html">grid_to_region</a></span><span class="op">(</span>grid_annual_value <span class="op">=</span> <span class="va">pwc.hothaps.ann</span>, SECTOR <span class="op">=</span> <span class="st">"MAIZ_R"</span>, rast_boundary <span class="op">=</span> <span class="va">reg_WB_raster</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="step3-1-aggregate-grid-level-values-to-country-level-values">Step3.1: aggregate grid-level values to country-level values<a class="anchor" aria-label="anchor" href="#step3-1-aggregate-grid-level-values-to-country-level-values"></a>
</h3>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">GCAM_country</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">ctry_pwc</span>, by <span class="op">=</span> <span class="st">"region_id"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df.plot</span></span>
<span></span>
<span><span class="va">df.plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://trevorldavis.com/R/ggpattern/reference/geom-docs.html" class="external-link">geom_sf_pattern</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">df.plot</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, <span class="st">"stripe"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                  pattern_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                  pattern_density <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                  pattern_spacing <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"PWC \nloss(%)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Country-level heat-induced PWC loss for labor in rain-fed maize sector: 2024"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step3.1-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="step3-2-aggregate-grid-level-values-to-gcam-waterbasin-level-values">Step3.2: aggregate grid-level values to GCAM waterbasin level
values<a class="anchor" aria-label="anchor" href="#step3-2-aggregate-grid-level-values-to-gcam-waterbasin-level-values"></a>
</h3>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reg_WB</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">glu_pwc</span>, by <span class="op">=</span> <span class="st">"region_id"</span><span class="op">)</span> <span class="op">-&gt;</span> <span class="va">df.plot</span></span>
<span></span>
<span><span class="va">df.plot</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://trevorldavis.com/R/ggpattern/reference/geom-docs.html" class="external-link">geom_sf_pattern</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fl">100</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  pattern <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">df.plot</span><span class="op">$</span><span class="va">value</span><span class="op">)</span>, <span class="st">"stripe"</span>, <span class="st">"none"</span><span class="op">)</span>,</span>
<span>                  pattern_color <span class="op">=</span> <span class="st">"black"</span>,</span>
<span>                  pattern_density <span class="op">=</span> <span class="fl">0.3</span>,</span>
<span>                  pattern_spacing <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">"grey95"</span>, high <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"longitude"</span>, y <span class="op">=</span> <span class="st">"latitude"</span>, fill <span class="op">=</span> <span class="st">"PWC \nloss(%)"</span>,</span>
<span>       title <span class="op">=</span> <span class="st">"Water basin-level heat-induced PWC loss for labor in rain-fed maize sector: 2024"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="HELPS-vignette_files/figure-html/Step3.2-1.png" width="960"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Di Sheng, Xin Zhao, Stephanie Waldhoff, Abigail Snyder, Chris Vernon.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
